<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>UKS Analytics</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <style>
    body {
      background: #f5f7fb
    }

    .card {
      border-radius: 14px;
      border: none
    }

    .filter-bar {
      position: sticky;
      top: 0;
      background: white;
      z-index: 1000
    }

    .chart-actions {
      opacity: 0;
      transition: .2s
    }

    .card:hover .chart-actions {
      opacity: 1
    }

    body {
      background: #f4f6fb;
      font-family: Inter, system-ui;
    }

    .app-header {
      background: linear-gradient(135deg, #ffffff, #f8f9ff);
      border-bottom: 1px solid #eee;
      height: 64px;
    }

    .app-title {
      font-size: 20px;
      font-weight: 600;
      letter-spacing: .3px;
    }

    .filter-bar {
      position: sticky;
      top: 64px;
      background: white;
      z-index: 9;
      border-radius: 14px;
      margin: 5px 12px;
    }

    .filter-bar label {
      font-size: 13px;
      color: #666;
      font-weight: 500;
    }

    .form-select,
    .form-range {
      border-radius: 10px;
    }

    .card {
      border-radius: 18px;
      border: none;
      background: white;
      box-shadow: 0 8px 25px rgba(0, 0, 0, .06);
      transition: .25s;
    }

    .card:hover {
      box-shadow: 0 12px 35px rgba(0, 0, 0, .1);
    }

    .chart-actions {
      opacity: 0;
      transition: .2s;
    }

    .card:hover .chart-actions {
      opacity: 1;
    }

    .btn-primary {
      background: linear-gradient(135deg, #4f46e5, #6366f1);
      border: none;
      border-radius: 10px;
    }

    .btn-outline-secondary {
      border-radius: 10px;
    }

    .dropdown-menu {
      border-radius: 12px;
      min-width: 180px;
    }

    .dropdown-item {
      font-size: 14px;
      padding: 10px 14px;
    }

    ul.dropdown-menu.dropdown-menu-end.shadow.show {
      z-index: 9999;
    }

    h5 i {
      opacity: 0.8;
    }

    .btn-group-sm .btn {
      border-radius: 8px;
      padding: 4px 10px;
    }

    input[type="date"] {
      border-radius: 8px;
    }

    .app-wrapper {
      display: flex;
    }

    .sidebar {
      position: fixed;
      top: 64px;
      left: 0;
      width: 240px;
      height: calc(100vh - 64px);
      background: linear-gradient(180deg, #f9fafc, #f2f4f9);
      border-right: 1px solid #eee;
      transition: transform .3s ease;
      z-index: 2000;
    }

    .sidebar-header {
      height: 64px;
      display: flex;
      align-items: center;
      padding: 0 16px;
      border-bottom: 1px solid #eee;
    }

    .sidebar-menu li.active {
      background: linear-gradient(135deg, #5b5df0, #7b7dff);
      color: white;
      box-shadow: 0 6px 16px rgba(91, 93, 240, .35);
    }

    .sidebar-menu i {
      width: 34px;
      height: 34px;
      border-radius: 10px;
      background: #eef0f7;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .sidebar-menu {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .sidebar-menu li a {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 16px;
      text-decoration: none;
      color: #444;
      font-size: 14px;
    }

    .sidebar-menu li a:hover {
      background: #f3f5ff;
      color: #4f46e5;
    }

    .submenu {
      list-style: none;
      padding-left: 30px;
    }

    .submenu li a {
      padding: 8px 16px;
      font-size: 13px;
    }

    .main-content {
      margin-left: 240px;
      width: 100%;
      transition: .3s;
      margin-top: 64px;
    }

    .main-content.collapsed {
      margin-left: 70px;
    }

    .app-header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 64px;
      z-index: 2000;
    }

    .main-content {
      margin-top: 64px;
    }

    .sidebar.collapsed .sidebar-header span {
      display: none;
    }

    .sidebar.collapsed .sidebar-menu span {
      display: none;
    }

    .sidebar.collapsed .submenu {
      display: none !important;
    }

    .sidebar.collapsed .sidebar-header img {
      display: none;
    }

    .sidebar.collapsed {
      width: 0;
      overflow: hidden;
    }

    .main-content.collapsed {
      margin-left: 0;
    }

    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-100%);
      }

      .sidebar.open {
        transform: translateX(0);
      }

      .filter-bar .col-md-2,
      .filter-bar .col-md-3 {
        margin-bottom: 10px;
      }
    }

    @media (max-width: 992px) {
      .chart-row {
        flex-direction: column;
      }
    }

    @media (max-width: 480px) {
      body {
        font-size: 14px;
      }

      h5 {
        font-size: 16px;
      }

      .app-title {
        font-size: 16px;
      }
    }

    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-100%);
        width: 240px;
      }

      .sidebar.collapsed {
        transform: translateX(-100%);
      }

      .sidebar:not(.collapsed) {
        transform: translateX(0);
        box-shadow: 0 0 0 9999px rgba(0, 0, 0, .25);
      }

      .main-content {
        margin-left: 0 !important;
      }
    }

    @media (max-width: 768px) {
      .filterWraps {
        width: auto !important;
        margin-left: 15px;
        margin-top: 10px;
      }

      .nomob {
        display: none !important;
      }

      .sidebar {
        transform: translateX(-100%);
        width: 240px;
      }

      .sidebar.open {
        transform: translateX(0);
        box-shadow: 0 0 0 9999px rgba(0, 0, 0, .35);
      }

      .sidebar.collapsed {
        width: 240px;
        overflow: visible;
      }

      .main-content {
        margin-left: 0 !important;
      }
    }

    .filter-section {
      background: #f8f9fa;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 15px;
      border-left: 4px solid;
    }

    .geographic-filter {
      border-left-color: #4f46e5;
    }

    .demographic-filter {
      border-left-color: #10b981;
    }

    .scheme-filter {
      border-left-color: #f59e0b;
    }

    .active-filter-badge {
      background: #4f46e5;
      color: white;
      border-radius: 12px;
      padding: 3px 10px;
      font-size: 12px;
      margin-right: 5px;
      margin-bottom: 5px;
      display: inline-block;
    }

    .logic-toggle {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 15px;
    }

    .logic-toggle .btn-group {
      width: 120px;
    }

    .logic-toggle .form-check {
      margin: 0;
    }

    .filter-group-title {
      font-weight: 600;
      color: #333;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .count-badge {
      background: #4f46e5;
      color: white;
      border-radius: 20px;
      padding: 2px 8px;
      font-size: 11px;
      margin-left: 5px;
    }
  </style>
</head>

<body>
  <nav class="navbar navbar-expand-lg app-header px-4">
    <div class="d-flex align-items-center">
      <button class="btn btn-sm btn-light" onclick="toggleSidebar()">
        <i class="bi bi-list"></i>
      </button>
      <img src="assets/img/tn_logo.png" height="36" class="me-2">
      <span class="ms-2 fw-bold">UKS Analytics</span>
    </div>
    <div class="ms-auto d-flex align-items-center gap-3 nomob">
      <div class="dropdown">
        <button class="btn btn-link text-decoration-none d-flex align-items-center gap-2" data-bs-toggle="dropdown">
          <span class="text-muted">Welcome, <b>User Name</b></span>
          <i class="bi bi-chevron-down"></i>
        </button>
        <ul class="dropdown-menu dropdown-menu-end shadow">
          <li><a class="dropdown-item" href="#"><i class="bi bi-person me-2"></i> Profile</a></li>
          <li>
            <hr class="dropdown-divider">
          </li>
          <li><a class="dropdown-item text-danger" href="#"><i class="bi bi-box-arrow-right me-2"></i> Logout</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="app-wrapper">
    <div id="sidebar" class="sidebar">
      <ul class="sidebar-menu">
        <li class="active"><a href="#"><i class="bi bi-speedometer2"></i> <span>Dashboard</span></a></li>
        <li><a href="#"><i class="bi bi-people"></i> <span>Beneficiary</span></a></li>
        <li><a href="#"><i class="bi bi-card-checklist"></i> <span>Beneficial Scheme</span></a></li>
        <li><a href="dreamscheme.html"><i class="bi bi-stars"></i> <span>Dream Scheme</span></a></li>
      </ul>
    </div>

    <div id="main" class="main-content">
      <button class="btn btn-outline-primary w-100 d-md-none filterWraps" data-bs-toggle="collapse"
        data-bs-target="#mobileFilters">
        <i class="bi bi-funnel"></i> Filters
      </button>

      <div id="mobileFilters" class="collapse d-md-block">
        <div class="filter-bar p-3 shadow-sm">
          <!-- Logic Toggle -->
          <div class="logic-toggle">
            <span class="filter-group-title">Filter Logic:</span>
            <div class="btn-group" role="group">
              <input type="radio" class="btn-check" name="filterLogic" id="logicAND" autocomplete="off" checked
                onclick="updateFilterLogic('AND')">
              <label class="btn btn-outline-primary" for="logicAND">AND</label>

              <input type="radio" class="btn-check" name="filterLogic" id="logicOR" autocomplete="off"
                onclick="updateFilterLogic('OR')">
              <label class="btn btn-outline-primary" for="logicOR">OR</label>
            </div>
            <span id="logicIndicator" class="badge bg-primary">AND Logic</span>
          </div>

          <!-- Geographic Filters -->
          <div class="filter-section geographic-filter">
            <div class="filter-group-title">
              <i class="bi bi-geo-alt"></i>
              Geographic Filters
            </div>
            <div class="row g-3 align-items-end">
              <div class="col-md-3">
                <label>District</label>
                <select id="district" class="form-select">
                  <option value="ALL" selected>All Districts</option>
                  <option value="Chennai">Chennai</option>
                  <option value="Madurai">Madurai</option>
                  <option value="Coimbatore">Coimbatore</option>
                  <option value="Tiruchirappalli">Tiruchirappalli</option>
                  <option value="Salem">Salem</option>
                </select>
              </div>

              <div class="col-md-3">
                <label>Taluk</label>
                <select id="taluk" class="form-select">
                  <option value="ALL" selected>All Taluks</option>
                </select>
              </div>

              <div class="col-md-3">
                <label>Village</label>
                <select id="village" class="form-select">
                  <option value="ALL" selected>All Villages</option>
                </select>
              </div>

              <div class="col-md-3">
                <label>Shop/Outlet</label>
                <select id="shop" class="form-select">
                  <option value="ALL" selected>All Shops</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Demographic Filters -->
          <div class="filter-section demographic-filter">
            <div class="filter-group-title">
              <i class="bi bi-people"></i>
              Demographic Filters
            </div>
            <div class="row g-3 align-items-end">
              <div class="col-md-3">
                <label>Gender</label>
                <select id="gender" class="form-select">
                  <option value="ALL" selected>All Genders</option>
                  <option value="Male">Male</option>
                  <option value="Female">Female</option>
                  <option value="Other">Other</option>
                </select>
              </div>

              <div class="col-md-3">
                <label>Age Range</label>
                <div class="d-flex gap-2">
                  <input type="number" id="ageMin" class="form-control" placeholder="Min" min="18" max="100" value="18">
                  <input type="number" id="ageMax" class="form-control" placeholder="Max" min="18" max="100" value="80">
                </div>
              </div>

              <div class="col-md-3">
                <label>Date Range</label>
                <div class="d-flex align-items-center gap-2">
                  <input type="date" id="dateFrom" class="form-control form-control-sm" value="2024-01-01">
                  <span class="text-muted">to</span>
                  <input type="date" id="dateTo" class="form-control form-control-sm" value="2024-03-31">
                </div>
              </div>

              <div class="col-md-3">
                <label>Status</label>
                <select id="status" class="form-select">
                  <option value="ALL" selected>All Status</option>
                  <option value="Active">Active</option>
                  <option value="Pending">Pending</option>
                  <option value="Inactive">Inactive</option>
                  <option value="Suspended">Suspended</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Scheme Filters -->
          <div class="filter-section scheme-filter">
            <div class="filter-group-title">
              <i class="bi bi-card-checklist"></i>
              Scheme Filters
            </div>
            <div class="row g-3 align-items-end">
              <div class="col-md-6">
                <label>Scheme Category</label>
                <select id="schemeCategory" class="form-select">
                  <option value="ALL" selected>All Categories</option>
                  <option value="Food Security">Food Security</option>
                  <option value="Cash Transfer">Cash Transfer</option>
                  <option value="Agriculture">Agriculture</option>
                  <option value="Employment">Employment</option>
                </select>
              </div>

              <div class="col-md-6">
                <label>Scheme</label>
                <select id="scheme" class="form-select">
                  <option value="ALL" selected>All Schemes</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="row mt-3">
            <div class="col-md-8">
              <div id="activeFiltersDisplay" class="d-flex flex-wrap gap-2"></div>
            </div>
            <div class="col-md-4 d-flex gap-2 justify-content-end">
              <button class="btn btn-primary" onclick="applyFilters()">
                <i class="bi bi-funnel me-2"></i> Apply Filters
              </button>
              <button class="btn btn-outline-danger" onclick="resetAll()">
                <i class="bi bi-arrow-counterclockwise"></i>
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="container-fluid mt-4">
        <!-- Summary Cards -->
        <div class="row g-3 mb-4">
          <div class="col-md-3">
            <div class="card p-3 shadow">
              <div class="d-flex align-items-center">
                <div class="rounded-circle bg-primary bg-opacity-10 p-3 me-3">
                  <i class="bi bi-people text-primary fs-4"></i>
                </div>
                <div>
                  <h6 class="text-muted mb-1">Total Beneficiaries</h6>
                  <h4 id="totalBeneficiariesCount" class="mb-0">0</h4>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card p-3 shadow">
              <div class="d-flex align-items-center">
                <div class="rounded-circle bg-success bg-opacity-10 p-3 me-3">
                  <i class="bi bi-check-circle text-success fs-4"></i>
                </div>
                <div>
                  <h6 class="text-muted mb-1">Active Beneficiaries</h6>
                  <h4 id="activeBeneficiariesCount" class="mb-0">0</h4>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card p-3 shadow">
              <div class="d-flex align-items-center">
                <div class="rounded-circle bg-warning bg-opacity-10 p-3 me-3">
                  <i class="bi bi-clock text-warning fs-4"></i>
                </div>
                <div>
                  <h6 class="text-muted mb-1">Pending Beneficiaries</h6>
                  <h4 id="pendingBeneficiariesCount" class="mb-0">0</h4>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card p-3 shadow">
              <div class="d-flex align-items-center">
                <div class="rounded-circle bg-info bg-opacity-10 p-3 me-3">
                  <i class="bi bi-shop text-info fs-4"></i>
                </div>
                <div>
                  <h6 class="text-muted mb-1">Active Shops</h6>
                  <h4 id="activeShopsCount" class="mb-0">0</h4>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="row g-3">
          <!-- Pie Chart - Smaller size -->
          <div class="col-lg-5">
            <div class="card p-3 shadow">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="d-flex align-items-center gap-2 mb-0">
                  <i class="bi bi-pie-chart-fill text-primary"></i>
                  Geographic Distribution
                  <span id="filterSummary" class="text-muted fs-6 ms-2"></span>
                </h5>
                <div class="chart-actions">
                  <button class="btn btn-sm btn-outline-secondary" onclick="exportCSV('pie')">
                    <i class="bi bi-file-earmark-excel"></i> CSV
                  </button>
                  <button class="btn btn-sm btn-outline-secondary" onclick="exportPDF('pie')">
                    <i class="bi bi-file-earmark-pdf"></i> PDF
                  </button>
                </div>
              </div>
              <div id="pie" style="height:350px"></div>
            </div>
          </div>

          <!-- Status-wise Breakdown - Stacked Bar Chart for All Districts -->
          <div class="col-lg-7">
            <div class="card p-3 shadow h-100">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="d-flex align-items-center gap-2 mb-0">
                  <i class="bi bi-bar-chart-fill text-success"></i>
                  District-wise Status Breakdown
                </h5>
                <div class="chart-actions">
                  <button class="btn btn-sm btn-outline-secondary" onclick="exportCSV('status')">
                    <i class="bi bi-file-earmark-excel"></i> CSV
                  </button>
                  <button class="btn btn-sm btn-outline-secondary" onclick="exportPDF('status')">
                    <i class="bi bi-file-earmark-pdf"></i> PDF
                  </button>
                </div>
              </div>
              <div id="statusChart" style="height:350px"></div>
            </div>
          </div>
        </div>

        <div class="row g-3 mt-3">
          <div class="col-lg-6">
            <div class="card p-3 shadow">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="d-flex align-items-center gap-2 mb-0">
                  <i class="bi bi-shop text-warning"></i>
                  Shop Performance
                </h5>
                <div class="chart-actions">
                  <button class="btn btn-sm btn-outline-secondary" onclick="exportCSV('shop')">
                    <i class="bi bi-file-earmark-excel"></i> CSV
                  </button>
                </div>
              </div>
              <div id="shopChart" style="height:350px"></div>
            </div>
          </div>

          <div class="col-lg-6">
            <div class="card p-3 shadow">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="d-flex align-items-center gap-2 mb-0">
                  <i class="bi bi-calendar-week text-info"></i>
                  Monthly Enrollment
                </h5>
                <div class="chart-actions">
                  <button class="btn btn-sm btn-outline-secondary" onclick="exportCSV('trend')">
                    <i class="bi bi-file-earmark-excel"></i> CSV
                  </button>
                </div>
              </div>
              <div id="trendChart" style="height:350px"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    $(document).ready(function () {
      // Initialize data and charts
      initializeData();

      // Trigger district change to populate other dropdowns
      $('#district').trigger('change');

      // Apply filters on load
      setTimeout(() => {
        applyFilters();
      }, 100);
    });

    // Global variable for filter logic
    let filterLogic = 'AND';

    // Update filter logic
    function updateFilterLogic(logic) {
      filterLogic = logic;
      document.getElementById('logicIndicator').textContent = `${logic} Logic`;
      applyFilters();
    }

    // Enhanced Sample Data Structure with Status
    const SAMPLE_DATA = {
      beneficiaries: [
        {
          id: 1,
          district: "Chennai",
          taluk: "Ambattur",
          village: "Ambattur Village",
          shop: "Shop A1",
          scheme: "KMUT",
          schemeCategory: "Food Security",
          status: "Active",
          gender: "Male",
          age: 25,
          enrollmentDate: "2024-01-15",
          amount: 1500
        },
        {
          id: 2,
          district: "Chennai",
          taluk: "Ambattur",
          village: "Ambattur Village",
          shop: "Shop A1",
          scheme: "DBT",
          schemeCategory: "Cash Transfer",
          status: "Active",
          gender: "Female",
          age: 32,
          enrollmentDate: "2024-01-20",
          amount: 2000
        },
        {
          id: 3,
          district: "Chennai",
          taluk: "Ambattur",
          village: "Ambattur Village",
          shop: "Shop A2",
          scheme: "PDS",
          schemeCategory: "Food Security",
          status: "Pending",
          gender: "Male",
          age: 45,
          enrollmentDate: "2024-02-10",
          amount: 1000
        },
        {
          id: 4,
          district: "Chennai",
          taluk: "Ambattur",
          village: "Korattur",
          shop: "Shop K1",
          scheme: "KMUT",
          schemeCategory: "Food Security",
          status: "Active",
          gender: "Female",
          age: 28,
          enrollmentDate: "2024-01-05",
          amount: 1500
        },
        {
          id: 5,
          district: "Chennai",
          taluk: "T. Nagar",
          village: "T. Nagar Main",
          shop: "Shop T1",
          scheme: "PMKSY",
          schemeCategory: "Agriculture",
          status: "Inactive",
          gender: "Male",
          age: 50,
          enrollmentDate: "2023-12-15",
          amount: 3000
        },
        {
          id: 6,
          district: "Madurai",
          taluk: "Thirumangalam",
          village: "Thirumangalam Town",
          shop: "Shop TM1",
          scheme: "MGNREGA",
          schemeCategory: "Employment",
          status: "Active",
          gender: "Female",
          age: 35,
          enrollmentDate: "2024-02-01",
          amount: 1800
        },
        {
          id: 7,
          district: "Madurai",
          taluk: "Thirumangalam",
          village: "Thirumangalam Town",
          shop: "Shop TM2",
          scheme: "DBT",
          schemeCategory: "Cash Transfer",
          status: "Pending",
          gender: "Male",
          age: 40,
          enrollmentDate: "2024-02-15",
          amount: 2000
        },
        {
          id: 8,
          district: "Coimbatore",
          taluk: "Coimbatore North",
          village: "Gandhipuram",
          shop: "Shop G1",
          scheme: "PDS",
          schemeCategory: "Food Security",
          status: "Suspended",
          gender: "Female",
          age: 30,
          enrollmentDate: "2023-11-20",
          amount: 1000
        },
        {
          id: 9,
          district: "Coimbatore",
          taluk: "Coimbatore North",
          village: "R.S. Puram",
          shop: "Shop RS1",
          scheme: "KMUT",
          schemeCategory: "Food Security",
          status: "Active",
          gender: "Male",
          age: 55,
          enrollmentDate: "2024-01-30",
          amount: 1500
        },
        {
          id: 10,
          district: "Tiruchirappalli",
          taluk: "Srirangam",
          village: "Srirangam Town",
          shop: "Shop SR1",
          scheme: "DBT",
          schemeCategory: "Cash Transfer",
          status: "Active",
          gender: "Female",
          age: 38,
          enrollmentDate: "2024-02-05",
          amount: 2000
        },
        {
          id: 11,
          district: "Salem",
          taluk: "Salem City",
          village: "Salem Main",
          shop: "Shop SL1",
          scheme: "PMKSY",
          schemeCategory: "Agriculture",
          status: "Inactive",
          gender: "Male",
          age: 60,
          enrollmentDate: "2023-10-10",
          amount: 3000
        },
        {
          id: 12,
          district: "Chennai",
          taluk: "T. Nagar",
          village: "T. Nagar Main",
          shop: "Shop T2",
          scheme: "MGNREGA",
          schemeCategory: "Employment",
          status: "Active",
          gender: "Other",
          age: 42,
          enrollmentDate: "2024-02-20",
          amount: 1800
        },
        {
          id: 13,
          district: "Madurai",
          taluk: "Melur",
          village: "Melur Town",
          shop: "Shop M1",
          scheme: "PDS",
          schemeCategory: "Food Security",
          status: "Pending",
          gender: "Female",
          age: 29,
          enrollmentDate: "2024-02-25",
          amount: 1000
        },
        {
          id: 14,
          district: "Coimbatore",
          taluk: "Sulur",
          village: "Sulur Town",
          shop: "Shop S1",
          scheme: "KMUT",
          schemeCategory: "Food Security",
          status: "Active",
          gender: "Male",
          age: 33,
          enrollmentDate: "2024-01-25",
          amount: 1500
        },
        {
          id: 15,
          district: "Salem",
          taluk: "Salem City",
          village: "Salem Main",
          shop: "Shop SL2",
          scheme: "DBT",
          schemeCategory: "Cash Transfer",
          status: "Active",
          gender: "Female",
          age: 27,
          enrollmentDate: "2024-02-28",
          amount: 2000
        },
        {
          id: 16,
          district: "Chennai",
          taluk: "Ambattur",
          village: "Ambattur Village",
          shop: "Shop A3",
          scheme: "KMUT",
          schemeCategory: "Food Security",
          status: "Active",
          gender: "Male",
          age: 35,
          enrollmentDate: "2024-01-10",
          amount: 1500
        },
        {
          id: 17,
          district: "Madurai",
          taluk: "Thirumangalam",
          village: "Kalligudi",
          shop: "Shop KAL1",
          scheme: "PDS",
          schemeCategory: "Food Security",
          status: "Active",
          gender: "Female",
          age: 45,
          enrollmentDate: "2024-02-12",
          amount: 1000
        },
        {
          id: 18,
          district: "Coimbatore",
          taluk: "Coimbatore North",
          village: "R.S. Puram",
          shop: "Shop RS2",
          scheme: "DBT",
          schemeCategory: "Cash Transfer",
          status: "Suspended",
          gender: "Male",
          age: 38,
          enrollmentDate: "2023-12-05",
          amount: 2000
        },
        {
          id: 19,
          district: "Tiruchirappalli",
          taluk: "Srirangam",
          village: "Srirangam Town",
          shop: "Shop SR2",
          scheme: "MGNREGA",
          schemeCategory: "Employment",
          status: "Active",
          gender: "Male",
          age: 48,
          enrollmentDate: "2024-02-18",
          amount: 1800
        },
        {
          id: 20,
          district: "Salem",
          taluk: "Salem City",
          village: "Salem Main",
          shop: "Shop SL3",
          scheme: "PMKSY",
          schemeCategory: "Agriculture",
          status: "Inactive",
          gender: "Female",
          age: 55,
          enrollmentDate: "2023-11-30",
          amount: 3000
        }
      ],
      months: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']
    };

    // Initialize charts
    let pieChart = echarts.init(document.getElementById("pie"));
    let statusChart = echarts.init(document.getElementById("statusChart"));
    let shopChart = echarts.init(document.getElementById("shopChart"));
    let trendChart = echarts.init(document.getElementById("trendChart"));

    function initializeData() {
      // Collect unique values for dropdowns
      const districts = [...new Set(SAMPLE_DATA.beneficiaries.map(b => b.district))];
      const taluks = [...new Set(SAMPLE_DATA.beneficiaries.map(b => b.taluk))];
      const villages = [...new Set(SAMPLE_DATA.beneficiaries.map(b => b.village))];
      const shops = [...new Set(SAMPLE_DATA.beneficiaries.map(b => b.shop))];
      const schemes = [...new Set(SAMPLE_DATA.beneficiaries.map(b => b.scheme))];
      const schemeCategories = [...new Set(SAMPLE_DATA.beneficiaries.map(b => b.schemeCategory))];

      // Populate shops dropdown
      $('#shop').empty();
      $('#shop').append('<option value="ALL" selected>All Shops</option>');
      shops.sort().forEach(shop => {
        $('#shop').append(`<option value="${shop}">${shop}</option>`);
      });

      // Populate scheme dropdown
      $('#scheme').empty();
      $('#scheme').append('<option value="ALL" selected>All Schemes</option>');
      schemes.sort().forEach(scheme => {
        $('#scheme').append(`<option value="${scheme}">${scheme}</option>`);
      });

      // Populate scheme category dropdown
      $('#schemeCategory').empty();
      $('#schemeCategory').append('<option value="ALL" selected>All Categories</option>');
      schemeCategories.sort().forEach(category => {
        $('#schemeCategory').append(`<option value="${category}">${category}</option>`);
      });
    }

    // Cascading dropdowns for geographic filters
    $('#district').on('change', function () {
      const selectedDistrict = $(this).val();

      // Filter taluks based on selected district
      let filteredTaluks = [];
      if (selectedDistrict === 'ALL') {
        filteredTaluks = [...new Set(SAMPLE_DATA.beneficiaries.map(b => b.taluk))];
      } else {
        filteredTaluks = [...new Set(SAMPLE_DATA.beneficiaries
          .filter(b => b.district === selectedDistrict)
          .map(b => b.taluk))];
      }

      // Update taluk dropdown
      $('#taluk').empty();
      $('#taluk').append('<option value="ALL" selected>All Taluks</option>');
      filteredTaluks.sort().forEach(taluk => {
        $('#taluk').append(`<option value="${taluk}">${taluk}</option>`);
      });

      // Trigger village update
      $('#taluk').trigger('change');
    });

    $('#taluk').on('change', function () {
      const selectedDistrict = $('#district').val();
      const selectedTaluk = $(this).val();

      // Filter villages based on selected district and taluk
      let filteredVillages = [];
      if (selectedDistrict === 'ALL' && selectedTaluk === 'ALL') {
        filteredVillages = [...new Set(SAMPLE_DATA.beneficiaries.map(b => b.village))];
      } else if (selectedDistrict === 'ALL') {
        filteredVillages = [...new Set(SAMPLE_DATA.beneficiaries
          .filter(b => b.taluk === selectedTaluk)
          .map(b => b.village))];
      } else if (selectedTaluk === 'ALL') {
        filteredVillages = [...new Set(SAMPLE_DATA.beneficiaries
          .filter(b => b.district === selectedDistrict)
          .map(b => b.village))];
      } else {
        filteredVillages = [...new Set(SAMPLE_DATA.beneficiaries
          .filter(b => b.district === selectedDistrict && b.taluk === selectedTaluk)
          .map(b => b.village))];
      }

      // Update village dropdown
      $('#village').empty();
      $('#village').append('<option value="ALL" selected>All Villages</option>');
      filteredVillages.sort().forEach(village => {
        $('#village').append(`<option value="${village}">${village}</option>`);
      });
    });

    // Update active filters display
    function updateActiveFiltersDisplay() {
      const activeFilters = [];

      // Geographic filters
      const district = $('#district').val();
      if (district !== 'ALL') activeFilters.push(`District: ${district}`);

      const taluk = $('#taluk').val();
      if (taluk !== 'ALL') activeFilters.push(`Taluk: ${taluk}`);

      const village = $('#village').val();
      if (village !== 'ALL') activeFilters.push(`Village: ${village}`);

      const shop = $('#shop').val();
      if (shop !== 'ALL') activeFilters.push(`Shop: ${shop}`);

      // Demographic filters
      const gender = $('#gender').val();
      if (gender !== 'ALL') activeFilters.push(`Gender: ${gender}`);

      const ageMin = $('#ageMin').val();
      const ageMax = $('#ageMax').val();
      if (ageMin != 18 || ageMax != 80) {
        activeFilters.push(`Age: ${ageMin}-${ageMax}`);
      }

      const dateFrom = $('#dateFrom').val();
      const dateTo = $('#dateTo').val();
      if (dateFrom && dateTo) {
        activeFilters.push(`Date: ${new Date(dateFrom).toLocaleDateString()} to ${new Date(dateTo).toLocaleDateString()}`);
      }

      const status = $('#status').val();
      if (status !== 'ALL') activeFilters.push(`Status: ${status}`);

      // Scheme filters
      const schemeCategory = $('#schemeCategory').val();
      if (schemeCategory !== 'ALL') activeFilters.push(`Category: ${schemeCategory}`);

      const scheme = $('#scheme').val();
      if (scheme !== 'ALL') activeFilters.push(`Scheme: ${scheme}`);

      // Display active filters
      const display = $('#activeFiltersDisplay');
      if (activeFilters.length > 0) {
        let html = `<strong>Active Filters (${filterLogic} Logic):</strong> `;
        html += activeFilters.map(filter =>
          `<span class="active-filter-badge">${filter}</span>`
        ).join(' ');
        display.html(html);
      } else {
        display.html('<span class="text-muted">No filters applied</span>');
      }
    }

    // Helper function to check if beneficiary matches filter
    function beneficiaryMatchesFilter(beneficiary) {
      const filters = {
        geographic: {
          district: $('#district').val(),
          taluk: $('#taluk').val(),
          village: $('#village').val(),
          shop: $('#shop').val()
        },
        demographic: {
          gender: $('#gender').val(),
          ageMin: parseInt($('#ageMin').val()),
          ageMax: parseInt($('#ageMax').val()),
          dateFrom: $('#dateFrom').val(),
          dateTo: $('#dateTo').val(),
          status: $('#status').val()
        },
        scheme: {
          category: $('#schemeCategory').val(),
          scheme: $('#scheme').val()
        }
      };

      // Check geographic filters
      const geoConditions = [
        filters.geographic.district === 'ALL' || beneficiary.district === filters.geographic.district,
        filters.geographic.taluk === 'ALL' || beneficiary.taluk === filters.geographic.taluk,
        filters.geographic.village === 'ALL' || beneficiary.village === filters.geographic.village,
        filters.geographic.shop === 'ALL' || beneficiary.shop === filters.geographic.shop
      ];

      // Check demographic filters
      const demoConditions = [
        filters.demographic.gender === 'ALL' || beneficiary.gender === filters.demographic.gender,
        beneficiary.age >= filters.demographic.ageMin && beneficiary.age <= filters.demographic.ageMax,
        filters.demographic.status === 'ALL' || beneficiary.status === filters.demographic.status
      ];

      // Check date filter - only if date range is selected
      let dateCondition = true;
      if (filters.demographic.dateFrom && filters.demographic.dateTo) {
        const enrollmentDate = new Date(beneficiary.enrollmentDate);
        const fromDate = new Date(filters.demographic.dateFrom);
        const toDate = new Date(filters.demographic.dateTo);
        dateCondition = enrollmentDate >= fromDate && enrollmentDate <= toDate;
        demoConditions.push(dateCondition);
      }

      // Check scheme filters
      const schemeConditions = [
        filters.scheme.category === 'ALL' || beneficiary.schemeCategory === filters.scheme.category,
        filters.scheme.scheme === 'ALL' || beneficiary.scheme === filters.scheme.scheme
      ];

      // Apply logic based on filterLogic
      if (filterLogic === 'AND') {
        // All conditions must be true
        const geoMatch = geoConditions.every(c => c);
        const demoMatch = demoConditions.every(c => c);
        const schemeMatch = schemeConditions.every(c => c);
        return geoMatch && demoMatch && schemeMatch;
      } else {
        // OR logic: At least one group must match completely
        const geoMatch = geoConditions.every(c => c);
        const demoMatch = demoConditions.every(c => c);
        const schemeMatch = schemeConditions.every(c => c);

        // Check if we have any non-ALL filters in each group
        const hasGeoFilters = Object.values(filters.geographic).some(v => v !== 'ALL');
        const hasDemoFilters = Object.values(filters.demographic).some(v => v !== 'ALL' && v !== 18 && v !== 80); // exclude default age
        const hasSchemeFilters = Object.values(filters.scheme).some(v => v !== 'ALL');

        // If no filters are set, show all
        if (!hasGeoFilters && !hasDemoFilters && !hasSchemeFilters) return true;

        // For OR logic, check if at least one group with active filters matches
        let matches = 0;
        if (hasGeoFilters && geoMatch) matches++;
        if (hasDemoFilters && demoMatch) matches++;
        if (hasSchemeFilters && schemeMatch) matches++;

        return matches > 0;
      }
    }

    // Main filter function
    function filterData() {
      const filteredBeneficiaries = SAMPLE_DATA.beneficiaries.filter(beneficiaryMatchesFilter);

      // Calculate district totals for pie chart
      const districtTotals = {};

      // Calculate district-wise status breakdown for bar chart
      const districtStatusTotals = {};
      const allStatuses = ['Active', 'Pending', 'Inactive', 'Suspended'];

      filteredBeneficiaries.forEach(b => {
        // District totals for pie chart
        districtTotals[b.district] = (districtTotals[b.district] || 0) + 1;

        // District-wise status totals for stacked bar chart
        if (!districtStatusTotals[b.district]) {
          districtStatusTotals[b.district] = {
            Active: 0,
            Pending: 0,
            Inactive: 0,
            Suspended: 0,
            total: 0
          };
        }
        districtStatusTotals[b.district][b.status] = (districtStatusTotals[b.district][b.status] || 0) + 1;
        districtStatusTotals[b.district].total += 1;
      });

      // Calculate shop totals
      const shopTotals = {};

      // Calculate monthly trend
      const monthlyTrend = Array(12).fill(0);

      filteredBeneficiaries.forEach(b => {
        // Shop totals
        shopTotals[b.shop] = (shopTotals[b.shop] || 0) + 1;

        // Monthly trend (by enrollment month)
        const enrollmentDate = new Date(b.enrollmentDate);
        const monthIndex = enrollmentDate.getMonth(); // 0-11
        monthlyTrend[monthIndex] = (monthlyTrend[monthIndex] || 0) + 1;
      });

      // Calculate summary counts
      const activeCount = filteredBeneficiaries.filter(b => b.status === 'Active').length;
      const pendingCount = filteredBeneficiaries.filter(b => b.status === 'Pending').length;
      const uniqueShops = new Set(filteredBeneficiaries.filter(b => b.status === 'Active').map(b => b.shop)).size;

      // Prepare data for stacked bar chart
      const districts = Object.keys(districtStatusTotals).sort();
      const statusSeriesData = allStatuses.map(status => {
        return {
          name: status,
          type: 'bar',
          stack: 'total',
          emphasis: { focus: 'series' },
          data: districts.map(district => districtStatusTotals[district][status] || 0)
        };
      });

      return {
        filteredBeneficiaries,
        districtTotals,
        districtStatusTotals,
        districts,
        statusSeriesData,
        shopTotals,
        monthlyTrend,
        totalBeneficiaries: filteredBeneficiaries.length,
        activeCount,
        pendingCount,
        uniqueShops
      };
    }

    function applyFilters() {
      updateActiveFiltersDisplay();

      const {
        districtTotals,
        districts,
        statusSeriesData,
        shopTotals,
        monthlyTrend,
        totalBeneficiaries,
        activeCount,
        pendingCount,
        uniqueShops
      } = filterData();

      // Update summary cards
      $('#totalBeneficiariesCount').text(totalBeneficiaries.toLocaleString());
      $('#activeBeneficiariesCount').text(activeCount.toLocaleString());
      $('#pendingBeneficiariesCount').text(pendingCount.toLocaleString());
      $('#activeShopsCount').text(uniqueShops.toLocaleString());

      // Update Pie Chart - District Distribution (Reduced size)
      const pieData = Object.entries(districtTotals).map(([district, count]) => ({
        name: district,
        value: count
      })).sort((a, b) => b.value - a.value);

      pieChart.setOption({
        tooltip: {
          trigger: 'item',
          formatter: function (params) {
            const percentage = totalBeneficiaries > 0 ? ((params.value / totalBeneficiaries) * 100).toFixed(1) : '0.0';
            return `<b>${params.name}</b><br/>Beneficiaries: ${params.value.toLocaleString()}<br/>Percentage: ${percentage}%`;
          }
        },
        legend: {
          orient: 'vertical',
          left: 'left',
          top: 'center',
          textStyle: { fontSize: 11 }
        },
        series: [{
          name: 'Beneficiary Distribution',
          type: 'pie',
          radius: ['35%', '65%'],
          avoidLabelOverlap: false,
          itemStyle: {
            borderRadius: 8,
            borderColor: '#fff',
            borderWidth: 1.5
          },
          label: {
            show: true,
            formatter: function (params) {
              const count = params.value.toLocaleString();
              const percentage = totalBeneficiaries > 0 ? ((params.value / totalBeneficiaries) * 100).toFixed(1) : '0.0';
              return `${params.name}\n${count}`;
            },
            fontSize: 10,
            fontWeight: 'normal',
            color: '#333',
            lineHeight: 14
          },
          labelLine: { length: 8, length2: 15, smooth: true },
          emphasis: { label: { show: true, fontSize: 12, fontWeight: 'bold' } },
          data: pieData.length > 0 ? pieData : [{ name: 'No Data', value: 1, itemStyle: { color: '#f0f0f0' } }]
        }],
        color: ['#5470c6', '#91cc75', '#fac858', '#ee6666', '#73c0de', '#3ba272', '#fc8452', '#9a60b4']
      });

      // Update Status Chart - District-wise Status Breakdown (Stacked Bar Chart)
      statusChart.setOption({
        tooltip: {
          trigger: 'axis',
          axisPointer: { type: 'shadow' },
          formatter: function (params) {
            let tooltip = `<b>${params[0].name}</b><br/>`;
            let total = 0;

            params.forEach(param => {
              if (param.value > 0) {
                tooltip += `${param.seriesName}: ${param.value.toLocaleString()}<br/>`;
                total += param.value;
              }
            });

            tooltip += `<hr style="margin: 5px 0"/>`;
            tooltip += `<b>Total: ${total.toLocaleString()}</b>`;

            return tooltip;
          }
        },
        legend: {
          data: ['Active', 'Pending', 'Inactive', 'Suspended'],
          top: 'top',
          textStyle: { fontSize: 11 }
        },
        grid: { left: '3%', right: '4%', top: '15%', bottom: '10%', containLabel: true },
        xAxis: {
          type: 'category',
          data: districts,
          axisLabel: {
            interval: 0,
            rotate: districts.length > 4 ? 45 : 0,
            fontSize: 10,
            margin: districts.length > 4 ? 15 : 0
          }
        },
        yAxis: {
          type: 'value',
          name: 'Count',
          nameTextStyle: { fontSize: 11 }
        },
        series: statusSeriesData,
        color: ['#10b981', '#f59e0b', '#ef4444', '#8b5cf6']
      });

      // Update Shop Performance Chart
      const shopData = Object.entries(shopTotals)
        .map(([shop, total]) => ({ name: shop, value: total }))
        .sort((a, b) => b.value - a.value)
        .slice(0, 10);

      shopChart.setOption({
        tooltip: {
          trigger: 'axis',
          axisPointer: { type: 'shadow' },
          formatter: function (params) {
            return `<b>${params[0].name}</b><br/>Beneficiaries: ${params[0].value.toLocaleString()}`;
          }
        },
        grid: { left: '3%', right: '4%', bottom: '15%', containLabel: true },
        xAxis: {
          type: 'category',
          data: shopData.map(item => item.name),
          axisLabel: {
            interval: 0,
            rotate: 45,
            fontSize: 9,
            margin: 12
          }
        },
        yAxis: { type: 'value', name: 'Beneficiaries' },
        series: [{
          type: 'bar',
          data: shopData.map(item => item.value),
          itemStyle: {
            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
              { offset: 0, color: '#83bff6' },
              { offset: 0.5, color: '#188df0' },
              { offset: 1, color: '#188df0' }
            ])
          },
          label: {
            show: shopData.length > 0,
            position: 'top',
            formatter: '{c}',
            fontSize: 9
          }
        }]
      });

      // Update Monthly Trend Chart
      trendChart.setOption({
        tooltip: {
          trigger: 'axis',
          formatter: function (params) {
            return `<b>${params[0].name}</b><br/>New Beneficiaries: ${params[0].value.toLocaleString()}`;
          }
        },
        grid: { left: '3%', right: '4%', bottom: '10%', containLabel: true },
        xAxis: { type: 'category', data: SAMPLE_DATA.months },
        yAxis: { type: 'value', name: 'Beneficiaries' },
        series: [{
          name: 'Monthly Enrollment',
          type: 'line',
          data: monthlyTrend,
          smooth: true,
          lineStyle: { width: 3, color: '#ff6b6b' },
          itemStyle: { color: '#ff6b6b' },
          areaStyle: {
            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
              { offset: 0, color: 'rgba(255, 107, 107, 0.5)' },
              { offset: 1, color: 'rgba(255, 107, 107, 0.1)' }
            ])
          },
          markPoint: {
            data: [
              { type: 'max', name: 'Max' },
              { type: 'min', name: 'Min' }
            ]
          },
          markLine: {
            data: [{ type: 'average', name: 'Average' }]
          }
        }]
      });

      // Update filter summary
      $('#filterSummary').text(`(${totalBeneficiaries.toLocaleString()} beneficiaries)`);
    }

    function resetAll() {
      // Reset all dropdowns to "ALL" option
      $('#district').val('ALL').trigger('change');
      $('#taluk').val('ALL');
      $('#village').val('ALL');
      $('#shop').val('ALL');
      $('#gender').val('ALL');
      $('#status').val('ALL');
      $('#schemeCategory').val('ALL');
      $('#scheme').val('ALL');
      $('#ageMin').val(18);
      $('#ageMax').val(80);

      // Reset dates
      $('#dateFrom').val('2024-01-01');
      $('#dateTo').val('2024-03-31');

      // Reset logic to AND
      $('#logicAND').prop('checked', true);
      filterLogic = 'AND';
      document.getElementById('logicIndicator').textContent = 'AND Logic';

      // Apply filters after reset
      setTimeout(() => {
        applyFilters();
      }, 100);
    }

    // Export Functions
    function exportCSV(type) {
      let rows = "";
      const data = filterData();

      if (type === 'pie') {
        rows = "District,Beneficiaries,Percentage\n";
        const pieData = Object.entries(data.districtTotals).map(([district, count]) => ({
          name: district,
          value: count
        })).sort((a, b) => b.value - a.value);

        pieData.forEach(item => {
          const percentage = data.totalBeneficiaries > 0 ? ((item.value / data.totalBeneficiaries) * 100).toFixed(2) : '0.00';
          rows += `${item.name},${item.value},${percentage}%\n`;
        });
      } else if (type === 'status') {
        rows = "District,Active,Pending,Inactive,Suspended,Total\n";
        Object.entries(data.districtStatusTotals).forEach(([district, statusData]) => {
          rows += `${district},${statusData.Active},${statusData.Pending},${statusData.Inactive},${statusData.Suspended},${statusData.total}\n`;
        });
      } else if (type === 'shop') {
        rows = "Shop,Beneficiaries\n";
        Object.entries(data.shopTotals)
          .sort((a, b) => b[1] - a[1])
          .slice(0, 10)
          .forEach(([shop, count]) => {
            rows += `${shop},${count}\n`;
          });
      } else if (type === 'trend') {
        rows = "Month,New Beneficiaries\n";
        data.monthlyTrend.forEach((count, index) => {
          rows += `${SAMPLE_DATA.months[index]},${count}\n`;
        });
      }

      let blob = new Blob([rows]);
      let a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = `${type}_export.csv`;
      a.click();
    }

    function exportPDF(type) {
      let el;
      switch (type) {
        case 'pie': el = document.getElementById('pie'); break;
        case 'status': el = document.getElementById('statusChart'); break;
        default: el = document.getElementById('pie');
      }

      html2canvas(el).then(c => {
        let pdf = new jspdf.jsPDF();
        pdf.addImage(c.toDataURL(), "PNG", 10, 10, 180, 120);
        pdf.save(`${type}_chart.pdf`);
      });
    }

    // Initialize charts on window resize
    window.addEventListener('resize', function () {
      pieChart.resize();
      statusChart.resize();
      shopChart.resize();
      trendChart.resize();
    });

    // Sidebar functions
    function toggleSidebar() {
      $("#sidebar").toggleClass("collapsed");
      $("#main").toggleClass("collapsed");
      setTimeout(() => {
        pieChart.resize();
        statusChart.resize();
        shopChart.resize();
        trendChart.resize();
      }, 300);
    }

    if (window.innerWidth <= 768) {
      document.getElementById("sidebar").classList.add("collapsed");
      document.getElementById("main").classList.add("collapsed");
    }

    document.addEventListener("click", function (e) {
      if (window.innerWidth <= 768) {
        let sidebar = document.getElementById("sidebar");
        let btn = document.querySelector(".bi-list");

        if (!sidebar.contains(e.target) && !btn.contains(e.target)) {
          sidebar.classList.add("collapsed");
        }
      }
    });
  </script>
</body>

</html>